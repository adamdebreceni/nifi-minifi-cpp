name: "MiNiFi-CPP CI"
on: [push, pull_request, workflow_dispatch]
jobs:
  windows_VS2019:
    name: "windows-2019"
    runs-on: windows-2019
    timeout-minutes: 180
    steps:
      - name: Support longpaths
        run: git config --system core.longpaths true
      - id: checkout
        uses: actions/checkout@v2
      - name: Set up MSBuild
        uses: microsoft/setup-msbuild@v1.0.2
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      - name: Set up Lua
        uses: xpol/setup-lua@v0.3
      - id: install-sqliteodbc-driver
        run: |
          Invoke-WebRequest -Uri "http://www.ch-werner.de/sqliteodbc/sqliteodbc_w64.exe" -OutFile "sqliteodbc_w64.exe"
          ./sqliteodbc_w64.exe /S
        shell: powershell
      - name: build
        run: |
          PATH %PATH%;C:\Program Files (x86)\Windows Kits\10\bin\10.0.19041.0\x64
          PATH %PATH%;C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise\MSBuild\Current\Bin\Roslyn
          win_build_vs.bat ..\b /64 /CI /SCRIPTING /LUA_SCRIPTING
        shell: cmd
      - uses: actions/upload-artifact@v3
        with:
          name: windows-build
          path: D:\a\nifi-minifi-cpp\b\bin\Release\