name: "MiNiFi-CPP CI"
on: [push, pull_request, workflow_dispatch]
jobs:
  windows_VS2017:
    name: "windows-vs2017"
    runs-on: windows-2016
    timeout-minutes: 90
    steps:
      - id: checkout
        uses: actions/checkout@v2
      - name: Setup PATH
        uses: microsoft/setup-msbuild@v1.0.2
      - id: check env
        run: |
          C:
          cd C:\Program Files (x86)\Windows Kits\10\bin
          dir
      - id: build
        run: |
          cd custom-provider
          PATH %PATH%;C:\Program Files (x86)\Windows Kits\10\bin\10.0.17740.0\x86
          PATH %PATH%;C:\Program Files (x86)\Microsoft Visual Studio\2017\Enterprise\MSBuild\15.0\Bin\Roslyn
          mc -css Namespace provider.man
          rc provider.rc
          csc /target:library /unsafe /win32res:provider.res provider.cs
          wevtutil im provider.man
        shell: cmd
  windows_VS2019:
    name: "windows-vs2019"
    runs-on: windows-2019
    timeout-minutes: 90
    steps:
      - id: checkout
        uses: actions/checkout@v2
      - name: Setup PATH
        uses: microsoft/setup-msbuild@v1.0.2
      - id: check env
        run: |
          C:
          cd C:\Program Files (x86)\Windows Kits\10\bin
          dir
      - id: build
        run: |
          cd custom-provider
          PATH %PATH%;C:\Program Files (x86)\Windows Kits\10\bin\10.0.19030.0\x64
          PATH %PATH%;C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise\MSBuild\Current\Bin\Roslyn
          mc -css Namespace provider.man
          rc provider.rc
          csc /target:library /unsafe /win32res:provider.res provider.cs
          wevtutil im provider.man
        shell: cmd
